MopoSpeedo — GPS-nopeusmittari T-Display S3:lle


ESP32-S3 (LILYGO T-Display S3) + GPS → tyylikäs mopon nopeusmittari:

iso km/h (punainen yli 45 km/h)

oikealla suuntanuoli + heading (000–359)

yläpalkissa akku (V & %) + satelliitit

GPS-fix ja HDOP näkyvät ruudulla

ODO & TRIP (tallennus NVS:ään), TRIP-nollaus webistä

Öljynvaihtomuistutus 300 km välein (nollaus webistä)

Wi-Fi AP: selaimesta statsit, nollaukset & GPS-debug

Splash: HONDA / Monkey 1994 + “All code generated by ChatGPT 5”

Koodi: Arduino IDE (ESP32-core), kirjastot: TinyGPSPlus, TFT_eSPI, WebServer (ESP32-core), Preferences.

Laitteisto
MCU/Näyttö: LILYGO T-Display S3 (ESP32-S3 + 1.9" TFT)

GPS-moduuli: CASIC AT6558R (URANUS5) tai vastaava NMEA-vastaanotin
(toimii myös u-bloxilla; webistä löytyy “Enable NMEA” -painike molempiin)

Syöttö: 1S LiPo

Antenni: passiivinen patch (suositus: metallinen maataso alle) tai aktiivinen GPS-antenni

Kytkennät
GPS moduuli	ESP32-S3 (T-Display S3)
TX	GPIO16 (MCU RX)
RX	GPIO21 (MCU TX) – valinnainen
GND	GND
VCC	3.3 V (älä syötä 5 V)

TFT virta akulla: koodissa vedetään GPIO15 HIGH (LCD power enable) ja GPIO38 HIGH (taustavalo).

Rakennus
Arduino IDE 2.x suositeltu.
Asenna Boards Managerista ESP32 by Espressif (S3-tuki).

Asenna kirjastot:
TinyGPSPlus, TFT_eSPI (valitse Setup206_LilyGo_T_Display_S3 User_Setup_Select.h:ssa).

Board settings (tyypilliset):

Board: ESP32S3 Dev Module (tai LILYGO T-Display S3 jos listassa)

Flash Mode: QIO 80 MHz

PSRAM: OPI PSRAM

USB CDC On Boot: Enabled (sarjalle) — akkukäytössä voi kytkeä pois

Partition scheme: Default 4MB with spiffs

Lataa sketch ja avaa Serial Monitor @ 115200.

Käyttö
Näyttö
km/h keskellä vasemmalla
→ punainen yli 45 km/h, muuten valkoinen.
→ harmaa, jos fixi ei ole kunnossa (gating).

Oikealla suuntanuoli + heading.

Alhaalla FX:2D/3D ja HDOP.

Wi-Fi AP
SSID: MopoSpeedo

Salasana: mopo12345

Osoite: http://192.168.4.1/

Sivulta näet:

ODO & TRIP (sekä TRIP-nollaus)

Öljynvaihtomuistutus ja nollaus

Akku, satelliitit, fix, HDOP, GPS-baud

Huolto-ohjeen linkki (Honda Monkey Z50J 1992–99)

Debug-työkalut:

NMEA debug (sarjasilta USB ↔ GPS)

Scan GPS baud

Enable NMEA GGA/GSA/GSV/RMC/VTG (CASIC/u-blox/PMTK/UBX)

Set GPS baud 38400 / 115200 (CASIC PCAS01)

Miten nopeus lasketaan (lyhyesti)
Luetaan GPS:n ground speed TinyGPS++:n kautta: gps.speed.kmph() (tyypillisesti 1 Hz).

Näytetään/integroidaan vain kun fix on “vahva”: sijainti validi & tuore (<2 s), sat ≥ 3, HDOP < 10.

Välkynnän vähentämiseksi käytetään eksponentiaalista suodatusta:
filtered = a*raw + (1-a)*filtered (SPEED_FILTER_ALPHA).

ODO/TRIP integroidaan GPS-pisteiden välimatkasta.
Matkaa ei lisätä alle 1.0 km/h nopeuksilla ja yksittäinen hyppäys rajoitetaan (200 m/tick).

Koodi on perusteellisesti kommentoitu (englanniksi) lähteen alussa.

Vinkit nopeaan fixiin
Ensifix ulkona: vie antenni avotaivaan alle; patch vaakaan ja metallinen maataso alle (esim. 40×40 mm).

Nosta baudia 38400/115200 jos tuloste puuroutuu (GSV on pitkä).
Tee tämä webistä: Set GPS baud.

Kytke NMEA-lauseet päälle (webin Enable NMEA…), jotta saat GGA/GSA/GSV (sat/HDOP/fix).

Pidä GPS fyysisesti erossa ESP32:sta ja näytön step-upista (EMI); yhteinen GND on pakollinen.

Jos moduulissa on backup-akku (VBAT), liitä se → efemeris pysyy muistissa, warm-start on nopea.

Tiedostot
*.ino — Arduino-lähdekoodi

case.png — 3D-tulostettava kotelo (kuva yllä)

Kiitokset
LILYGO T-Display S3

TinyGPSPlus, TFT_eSPI

All code generated by ChatGPT 5

